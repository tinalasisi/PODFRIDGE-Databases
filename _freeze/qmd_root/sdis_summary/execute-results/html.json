{
  "hash": "62c631304aa46a1fd950de11cb77b521",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"SDIS Summary Analysis\"\nauthor: \"Tina Lasisi | Edited: Jo√£o P. Donadio\"\ndate: today\nformat:\n  html:\n    code-fold: false\n    toc: true\nexecute:\n  echo: true\n  warning: false\n---\n\n## Overview\n\nThis analysis examines State DNA Index System (SDIS) data that includes information reported separately for each state's DNA database. The data captures key dimensions including:\n\n- Total size of each state's DNA database\n- Whether states collect DNA from arrestees (not just convicted offenders)\n- Whether states allow familial DNA searching\n- References to relevant state statutes (from Murphy & Tong appendix)\n\nThis information provides insight into the variation in DNA database policies, practices, and legal frameworks across U.S. states.\n\n## Setup\n\nLoad necessary packages for the analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show setup code\"}\n# List of required packages\nrequired_packages <- c(\n  \"tidyverse\",    # Data manipulation and visualization\n  \"readr\",      # Reading CSV files\n  \"dplyr\",      # Data manipulation\n  \"tidyr\",      # Data tidying\n  \"purrr\",      # Functional programming tools\n  \"ggplot2\",    # Data visualization\n  \"heatmaply\",  # Interactive heatmaps\n  \"kableExtra\", # Enhanced tables for reporting\n  \"DT\",         # Interactive tables\n  \"flextable\",  # Flexible tables for reporting\n  \"maps\",       # Mapping tools\n  \"here\",       # File path management\n  \"remotes\",    # To install urbnmapr package\n  \"sf\",\n  \"patchwork\"\n)\n\n# Function to install missing packages\ninstall_missing <- function(packages) {\n  for (pkg in packages) {\n    if (!requireNamespace(pkg, quietly = TRUE)) {\n      message(paste(\"Installing missing package:\", pkg))\n      install.packages(pkg, dependencies = TRUE)\n    }\n  }\n}\n\n# Install any missing packages\ninstall_missing(required_packages)\n\n# Load all packages\nsuppressPackageStartupMessages({\n  library(tidyverse)\n  library(readr)\n  library(dplyr)\n  library(tidyr)\n  library(purrr)\n  library(ggplot2)\n  library(heatmaply)\n  library(kableExtra)\n  library(DT)\n  library(flextable)\n  library(maps)\n  library(here)\n  library(remotes)\n  library(sf)\n  library(patchwork)\n})\n\n# Verify all packages loaded successfully\nloaded_packages <- sapply(required_packages, require, character.only = TRUE)\nif (all(loaded_packages)) {\n  message(\"üìö All packages loaded successfully!\")\n} else {\n  warning(\"The following packages failed to load: \", \n          paste(names(loaded_packages)[!loaded_packages], collapse = \", \"))\n}\n```\n:::\n\n\n## Import SDIS data\n\nLoad the SDIS dataset and display a glimpse of its structure, including data types, missing values, and unique counts.\n\n**Database Columns Definition**\n\n| Column | Description |\n|--------|-------------|\n| state | Name of the U.S. state or jurisdiction |\n| n_total | Total number of DNA profiles in the state database |\n| n_arrestees | Number of arrestee DNA profiles in the database |\n| n_offenders | Number of convicted offender DNA profiles in the database |\n| n_forensic | Number of forensic/crime scene DNA profiles in the database |\n| arrestee_collection | Whether the state collects DNA from arrestees ('yes'/'no') |\n| collection_statute | Citation to the state's DNA collection statute |\n| fam_search | Family search policy status ('permitted', 'prohibited', 'unspecified') |\n| database_source | URL source for the database statistics |\n| database_source_year | Year the database statistics were reported |\n| verification_comment | Additional notes or comments about data verification |\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show import code\"}\n# Set up path to data file\ndata_file <- file.path(here(\"data\", \"sdis\", \"raw\", \"sdis_raw.csv\"))\n\n# Load the SDIS data\nsdis_data <- read_csv(data_file)\n\n# Display data types for each column\nenhanced_glimpse <- function(df) {\n  glimpse_data <- data.frame(\n    Column = names(df),\n    Type = sapply(df, function(x) paste(class(x), collapse = \", \")),\n    Rows = nrow(df),\n    Missing = sapply(df, function(x) sum(is.na(x))),\n    Unique = sapply(df, function(x) length(unique(x))),\n    First_Values = sapply(df, function(x) {\n      if(is.numeric(x)) {\n        paste(round(head(x, 3), 2), collapse = \", \")\n      } else {\n        paste(encodeString(head(as.character(x), 3)), collapse = \", \")\n      }\n    })\n  )\n  \n  ft <- flextable(glimpse_data) %>%\n    theme_zebra() %>%\n    set_caption(paste(\"Enhanced Data Glimpse:\", deparse(substitute(df)))) %>%\n    autofit() %>%\n    align(align = \"left\", part = \"all\") %>%\n    colformat_num(j = c(\"Rows\", \"Missing\", \"Unique\"), big.mark = \"\") %>%\n    bg(j = \"Missing\", bg = function(x) ifelse(x > 0, \"#FFF3CD\", \"transparent\")) %>%\n    bg(j = \"Unique\", bg = function(x) ifelse(x == 1, \"#FFF3CD\", \"transparent\")) %>%\n    add_footer_lines(paste(\"Data frame dimensions:\", nrow(df), \"rows √ó\", ncol(df), \"columns\")) %>%\n    fontsize(size = 10, part = \"all\") %>%\n    set_table_properties(layout = \"autofit\", width = 1)\n  \n  return(ft)\n}\n\nenhanced_glimpse(sdis_data)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5c4e4df8{table-layout:auto;width:100%;}.cl-5c42b006{font-family:'Helvetica';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c42b010{font-family:'Helvetica';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c4c4bfc{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5c4c598a{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5994{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5995{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c599e{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c599f{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59a0{background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59a8{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59a9{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59aa{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59b2{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59b3{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59b4{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59bc{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59bd{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59be{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59bf{background-color:rgba(255, 243, 205, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59c6{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59c7{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59c8{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59d0{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59d1{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59d2{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59da{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59db{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59dc{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59e4{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59e5{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59e6{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59ee{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59ef{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59f0{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59f1{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59f8{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59f9{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59fa{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c59fb{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a02{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a03{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a04{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a05{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a0c{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a0d{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a0e{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a16{background-color:rgba(255, 243, 205, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a17{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a18{background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a20{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a21{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a22{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a23{background-color:rgba(255, 243, 205, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a24{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a2a{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a2b{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a2c{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a34{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a35{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a36{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c4c5a37{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5c4e4df8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5c4c598a\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">Column</span></p></th><th class=\"cl-5c4c5994\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">Type</span></p></th><th class=\"cl-5c4c5995\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">Rows</span></p></th><th class=\"cl-5c4c599e\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">Missing</span></p></th><th class=\"cl-5c4c599f\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">Unique</span></p></th><th class=\"cl-5c4c59a0\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b006\">First_Values</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59a8\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">state</span></p></td><td class=\"cl-5c4c59a9\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c59aa\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59b2\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">0</span></p></td><td class=\"cl-5c4c59b3\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59b4\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">Alabama, Alaska, Arizona</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59bc\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">n_total</span></p></td><td class=\"cl-5c4c59bd\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">numeric</span></p></td><td class=\"cl-5c4c59be\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59bf\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">21</span></p></td><td class=\"cl-5c4c59c6\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">30</span></p></td><td class=\"cl-5c4c59c7\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">360000, 79146, NA</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59c8\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">n_arrestees</span></p></td><td class=\"cl-5c4c59d0\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c59d1\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59bf\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">25</span></p></td><td class=\"cl-5c4c59c6\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">10</span></p></td><td class=\"cl-5c4c59d2\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">&lt;NA&gt;, 52149, &lt;NA&gt;</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59bc\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">n_offenders</span></p></td><td class=\"cl-5c4c59bd\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">numeric</span></p></td><td class=\"cl-5c4c59be\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59bf\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">32</span></p></td><td class=\"cl-5c4c59c6\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">19</span></p></td><td class=\"cl-5c4c59c7\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">NA, 26997, NA</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59c8\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">n_forensic</span></p></td><td class=\"cl-5c4c59d0\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">numeric</span></p></td><td class=\"cl-5c4c59d1\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59bf\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">38</span></p></td><td class=\"cl-5c4c59c6\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">13</span></p></td><td class=\"cl-5c4c59d2\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">NA, 3866, NA</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59da\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">arrestee_collection</span></p></td><td class=\"cl-5c4c59db\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c59dc\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59e4\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">0</span></p></td><td class=\"cl-5c4c59e5\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">2</span></p></td><td class=\"cl-5c4c59e6\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">yes, yes, yes</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59ee\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">collection_statute</span></p></td><td class=\"cl-5c4c59ef\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c59f0\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59f1\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">0</span></p></td><td class=\"cl-5c4c59f8\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c59f9\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">Ala. Code Sec.36-18-25, AK Stat Sec.44.41.035 (2014), AZ Rev Stat Sec.13-610 (2016)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c59fa\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">fam_search</span></p></td><td class=\"cl-5c4c59fb\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c5a02\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c5a03\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">0</span></p></td><td class=\"cl-5c4c5a04\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">3</span></p></td><td class=\"cl-5c4c5a05\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">unspecified, unspecified, unspecified</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c5a0c\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">database_source</span></p></td><td class=\"cl-5c4c5a0d\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">character</span></p></td><td class=\"cl-5c4c5a0e\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c5a16\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">14</span></p></td><td class=\"cl-5c4c5a17\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">37</span></p></td><td class=\"cl-5c4c5a18\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">https://adfs.alabama.gov/services/fb/fb-statistics, https://dps.alaska.gov/Statewide/CrimeLab/Forensic-Biology/DNA, &lt;NA&gt;</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c4c5a20\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">database_source_year</span></p></td><td class=\"cl-5c4c5a21\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">numeric</span></p></td><td class=\"cl-5c4c5a22\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">50</span></p></td><td class=\"cl-5c4c5a23\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">16</span></p></td><td class=\"cl-5c4c5a24\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">11</span></p></td><td class=\"cl-5c4c5a2a\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">2024, 2024, NA</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"6\"class=\"cl-5c4c5a2b\"><p class=\"cl-5c4c4bfc\"><span class=\"cl-5c42b010\">Data frame dimensions: 50 rows √ó 10 columns</span></p></td></tr></tfoot></table></div>\n```\n\n:::\n:::\n\n\n## Arrestee Collection Information\n\nIn the United States, the collection of DNA from individuals upon arrest, prior to any conviction, is a significant law enforcement practice with complex legal and ethical dimensions.\n\nThe following map and table illustrate the current patchwork of state laws governing this practice.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show arrestee collection visualization code\"}\n# Create summary data for arrestee collection\narrestee_summary <- sdis_data %>%\n  group_by(arrestee_collection) %>%\n  summarise(\n    count = n(),\n    states = list(state),\n    .groups = \"drop\"\n  ) %>%\n  arrange(desc(count))\n\n# Get US state map data\nus_states <- map_data(\"state\")\n\n# Prepare map data\nmap_data <- sdis_data %>%\n  mutate(region = tolower(state)) %>%\n  right_join(us_states, by = \"region\") %>%\n  filter(!is.na(arrestee_collection))\n\n# Option 1: US Map Visualization\nmap_plot <- ggplot(map_data, aes(x = long, y = lat, group = group, fill = arrestee_collection)) +\n  geom_polygon(color = \"white\", linewidth = 0.2) +\n  coord_fixed(1.3) +\n  scale_fill_manual(\n    values = c(\n      \"yes\" = \"#0072B2\",      # Blue for collecting states\n      \"no\" = \"#666666\"       # Gray for non-collecting states\n    ),\n    name = \"Collects DNA from Arrestees\",\n    labels = c(\"No\", \"Yes\")\n  ) +\n  labs(\n    title = \"DNA Collection from Arrestees by State\",\n    subtitle = \"States that collect DNA samples from individuals upon arrest\"\n  ) +\n  theme_void() +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 16),\n    plot.subtitle = element_text(hjust = 0.5, color = \"gray40\", size = 12),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\")\n  )\n\n# Create detailed summary table\nsummary_table <- arrestee_summary %>%\n  mutate(\n    state_list = map_chr(states, ~paste(.x, collapse = \", \")),\n    percentage = round(count / sum(count) * 100, 1)\n  ) %>%\n  select(Status = arrestee_collection, Count = count, Percentage = percentage, States = state_list)\n\n# Display the visualizations\nprint(map_plot)\n```\n\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/arrestee-collection-visualization-1.png){width=1152}\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show arrestee collection visualization code\"}\n# Create a nice flextable for the report\nft <- flextable(summary_table) %>%\n  theme_zebra() %>%\n  set_caption(\"Arrestee DNA Collection Status by State\") %>%\n  autofit() %>%\n  align(align = \"left\", part = \"all\") %>%\n  bg(j = \"Status\", bg = function(x) {\n    case_when(\n      is.na(x) ~ \"#CCCCCC\",\n      x == \"yes\" ~ \"#1f77b4\",\n      x == \"no\" ~ \"#666666\",\n      TRUE ~ \"#CCCCCC\"\n    )\n  }) %>%\n  color(j = \"Status\", color = \"white\") %>%\n  bold(j = \"Status\") %>%\n  fontsize(size = 11, part = \"all\")\n\nft\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5c792dca{}.cl-5c765938{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c765939{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-5c765942{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5c7774a8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5c7781b4{width:0.752in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781b5{width:0.726in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781be{width:1.109in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781bf{width:24.24in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781c0{width:0.752in;background-color:rgba(31, 119, 180, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781c8{width:0.726in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781c9{width:1.109in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781ca{width:24.24in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781d2{width:0.752in;background-color:rgba(102, 102, 102, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781d3{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781dc{width:1.109in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5c7781dd{width:24.24in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5c792dca'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5c7781b4\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765938\">Status</span></p></th><th class=\"cl-5c7781b5\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765938\">Count</span></p></th><th class=\"cl-5c7781be\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765938\">Percentage</span></p></th><th class=\"cl-5c7781bf\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765938\">States</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c7781c0\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765939\">yes</span></p></td><td class=\"cl-5c7781c8\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">33</span></p></td><td class=\"cl-5c7781c9\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">66</span></p></td><td class=\"cl-5c7781ca\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, Florida, Georgia, Illinois, Indiana, Kansas, Louisiana, Maryland, Michigan, Minnesota, Mississippi, Missouri, Nevada, New Jersey, New Mexico, North Carolina, North Dakota, Ohio, Oklahoma, Rhode Island, South Carolina, South Dakota, Tennessee, Texas, Utah, Virginia, Wisconsin</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5c7781d2\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765939\">no</span></p></td><td class=\"cl-5c7781d3\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">17</span></p></td><td class=\"cl-5c7781dc\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">34</span></p></td><td class=\"cl-5c7781dd\"><p class=\"cl-5c7774a8\"><span class=\"cl-5c765942\">Delaware, Hawaii, Idaho, Iowa, Kentucky, Maine, Massachusetts, Montana, Nebraska, New Hampshire, New York, Oregon, Pennsylvania, Vermont, Washington, West Virginia, Wyoming</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Adjusting `n_arrestees`\n\n- Adjust the dataset to ensure consistency in arrestee DNA collection reporting.\n\n- Setting `n_arrestees` to 0 for states that do not collect arrestee DNA, even if they report non-zero values.\n\n- Removed the `arrestee_colection` column after adjustments were made.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show pre-processing code\"}\n# Create a copy of the data for processing\nsdis_data_processed <- sdis_data\n\n# Count states affected by this adjustment\nstates_with_no_collection <- sdis_data_processed %>% \n  filter(arrestee_collection == 'no')\n\nstates_to_adjust <- states_with_no_collection %>% \n  filter(!is.na(n_arrestees) & n_arrestees != 0)\n\nif (nrow(states_to_adjust) > 0) {\n  cat(\"States with arrestee_collection='no' but non-zero n_arrestees values:\\n\")\n  for (i in 1:nrow(states_to_adjust)) {\n    state <- states_to_adjust[i, ]\n    cat(paste0(\"  ‚Ä¢ \", state$state, \": n_arrestees = \", format(state$n_arrestees, big.mark = \",\"), \"\\n\"))\n  }\n}\n\n# Set n_arrestees to 0 for states that don't collect arrestee DNA\nsdis_data_processed <- sdis_data_processed %>%\n  mutate(n_arrestees = ifelse(arrestee_collection == 'no', 0, n_arrestees))\n\n# Use processed data for all subsequent analyses\nsdis_data <- sdis_data_processed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStates with arrestee_collection='no' but non-zero n_arrestees values:\n  ‚Ä¢ Delaware: n_arrestees = N/A\n  ‚Ä¢ Hawaii: n_arrestees = N/A\n  ‚Ä¢ Idaho: n_arrestees = N/A\n  ‚Ä¢ Iowa: n_arrestees = N/A\n  ‚Ä¢ Maine: n_arrestees = N/A\n  ‚Ä¢ Massachusetts: n_arrestees = N/A\n  ‚Ä¢ Montana: n_arrestees = N/A\n  ‚Ä¢ Nebraska: n_arrestees = N/A\n  ‚Ä¢ New Hampshire: n_arrestees = N/A\n  ‚Ä¢ New York: n_arrestees = N/A\n  ‚Ä¢ Oregon: n_arrestees = N/A\n  ‚Ä¢ Pennsylvania: n_arrestees = N/A\n  ‚Ä¢ Vermont: n_arrestees = N/A\n  ‚Ä¢ Washington: n_arrestees = N/A\n  ‚Ä¢ West Virginia: n_arrestees = N/A\n  ‚Ä¢ Wyoming: n_arrestees = N/A\n```\n\n\n:::\n:::\n\n\n## Family Search Policy Status\n\nFamilial DNA searching is an advanced forensic technique that uses partial DNA matches to identify potential relatives of an unknown suspect in a criminal database.\n\nThe following visualization maps the current patchwork of state policies ('permitted', 'prohibited', 'unspecified').\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show family search policy visualization code\"}\n# Create summary data for family search policies\nfamily_search_summary <- sdis_data %>%\n  mutate(\n    fam_search = factor(fam_search, \n                       levels = c(\"permitted\", \"prohibited\", \"unspecified\"),\n                       labels = c(\"Permitted\", \"Prohibited\", \"Unspecified\")),\n    fam_search_simple = case_when(\n      fam_search == \"Permitted\" ~ \"Permitted\",\n      fam_search == \"Prohibited\" ~ \"Prohibited\",\n      TRUE ~ \"Unspecified/No Policy\"\n    )\n  ) %>%\n  group_by(fam_search, fam_search_simple) %>%\n  summarise(\n    count = n(),\n    states = list(state),\n    .groups = \"drop\"\n  ) %>%\n  arrange(desc(count))\n\n# Get complete data for mapping (include states with missing data)\nall_states_map <- map_data(\"state\") %>%\n  as_tibble() %>%\n  distinct(region) %>%\n  mutate(\n    state_name = str_to_title(region),\n    has_data = state_name %in% sdis_data$state\n  )\n\n# Prepare map data for family search policies\nfamily_search_map_data <- sdis_data %>%\n  mutate(\n    region = tolower(state)) %>%\n  right_join(map_data(\"state\"), by = c(\"region\" = \"region\")) %>%\n  filter(!is.na(fam_search))\n\n# Option 1: US Map Visualization\nfamily_map_plot <- ggplot(family_search_map_data, \n                         aes(x = long, y = lat, group = group, fill = fam_search)) +\n  geom_polygon(color = \"white\", linewidth = 0.2) +\n  coord_fixed(1.3) +\n  scale_fill_manual(\n    values = c(\n      \"permitted\" = \"#1f77b4\",    # Blue for permitted\n      \"prohibited\" = \"#000000ff\",   # Black for prohibited\n      \"unspecified\" = \"#666666\"   # Gray for unspecified\n    ),\n    name = \"Familial Search Policy\",\n    drop = FALSE\n  ) +\n  labs(\n    title = \"Familial DNA Search Policies by State\",\n    subtitle = \"State policies regarding familial DNA searching in databases\",\n    caption = \"Source: SDIS Database Analysis\"\n  ) +\n  theme_void() +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 16),\n    plot.subtitle = element_text(hjust = 0.5, color = \"gray40\", size = 12),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\")\n  )\n\n# Display the visualizations\nprint(family_map_plot)\n```\n\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/family-search-visualization-1.png){width=1152}\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show family search policy visualization code\"}\n# Create a comprehensive summary table\nsummary_table_data <- family_search_summary %>%\n  mutate(\n    state_list = map_chr(states, ~paste(.x, collapse = \", \")),\n    percentage = round(count / sum(count) * 100, 1)\n  ) %>%\n  select(Policy = fam_search, Count = count, Percentage = percentage, States = state_list)\n\n# Create a nice flextable for the report\nft <- flextable(summary_table_data) %>%\n  theme_zebra() %>%\n  set_caption(\"Familial DNA Search Policy Status by State\") %>%\n  autofit() %>%\n  align(align = \"center\", part = \"all\") %>%\n  align(align = \"left\", j = \"States\") %>%\n  bg(j = \"Policy\", bg = function(x) {\n    case_when(\n      x == \"Permitted\" ~ \"#1f77b4\",\n      x == \"Prohibited\" ~ \"#000000ff\",\n      TRUE ~ \"#666666\"\n    )\n  }) %>%\n  color(j = \"Policy\", color = \"white\") %>%\n  bold(j = \"Policy\") %>%\n  fontsize(size = 11, part = \"all\") %>%\n  width(j = \"States\", width = 3)\n\nft\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5caccba8{}.cl-5ca9aa04{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5ca9aa0e{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-5ca9aa0f{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5cab30ae{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5cab30b8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5cab3c20{width:1.083in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c21{width:0.726in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c22{width:1.109in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c2a{width:3in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c2b{width:1.083in;background-color:rgba(102, 102, 102, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c2c{width:0.726in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c2d{width:1.109in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c2e{width:3in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c34{width:1.083in;background-color:rgba(31, 119, 180, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c35{width:0.726in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c36{width:1.109in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c37{width:3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c3e{width:1.083in;background-color:rgba(0, 0, 0, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c3f{width:0.726in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c40{width:1.109in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5cab3c41{width:3in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5caccba8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5cab3c20\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa04\">Policy</span></p></th><th class=\"cl-5cab3c21\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa04\">Count</span></p></th><th class=\"cl-5cab3c22\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa04\">Percentage</span></p></th><th class=\"cl-5cab3c2a\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa04\">States</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5cab3c2b\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0e\">Unspecified</span></p></td><td class=\"cl-5cab3c2c\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">37</span></p></td><td class=\"cl-5cab3c2d\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">74</span></p></td><td class=\"cl-5cab3c2e\"><p class=\"cl-5cab30b8\"><span class=\"cl-5ca9aa0f\">Alabama, Alaska, Arizona, Connecticut, Delaware, Georgia, Hawaii, Idaho, Illinois, Indiana, Iowa, Kansas, Kentucky, Louisiana, Maine, Massachusetts, Minnesota, Mississippi, Missouri, Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, North Carolina, North Dakota, Ohio, Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina, South Dakota, Tennessee, Vermont, Washington, West Virginia</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5cab3c34\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0e\">Permitted</span></p></td><td class=\"cl-5cab3c35\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">12</span></p></td><td class=\"cl-5cab3c36\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">24</span></p></td><td class=\"cl-5cab3c37\"><p class=\"cl-5cab30b8\"><span class=\"cl-5ca9aa0f\">Arkansas, California, Colorado, Florida, Michigan, Montana, New York, Texas, Utah, Virginia, Wisconsin, Wyoming</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5cab3c3e\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0e\">Prohibited</span></p></td><td class=\"cl-5cab3c3f\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">1</span></p></td><td class=\"cl-5cab3c40\"><p class=\"cl-5cab30ae\"><span class=\"cl-5ca9aa0f\">2</span></p></td><td class=\"cl-5cab3c41\"><p class=\"cl-5cab30b8\"><span class=\"cl-5ca9aa0f\">Maryland</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n## Three-Panel Policy Map: Horizontal Layout\n\nThis visualization presents three key policy dimensions side-by-side: arrestee DNA collection, familial search policies, and FOIA data availability.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show three-panel map code\"}\nremotes::install_github(\"UrbanInstitute/urbnmapr\")\nlibrary(urbnmapr)\n\n# Create FOIA availability column\nsdis_data <- sdis_data %>%\n  mutate(\n    foia_availability = case_when(\n      state %in% c(\"California\", \"Florida\", \"Indiana\", \"Maine\", \n                   \"Nevada\", \"South Dakota\", \"Texas\") ~ \"provided\",\n      TRUE ~ \"not_provided\"\n    )\n  )\n\n# Load US map data with proper AK/HI positioning\nus_map_data <- get_urbn_map(\"states\", sf = TRUE)\n\n# Prepare map data\nsdis_data_map <- sdis_data %>%\n  mutate(region = tolower(state))\n\nus_map_data <- us_map_data %>%\n  mutate(region = tolower(state_name))\n\n# Merge polygon data with policy data\nmap_data_repos <- us_map_data %>%\n  left_join(sdis_data_map, by = \"region\")\n\n# Function to create individual maps\ncreate_policy_map <- function(fill_var, fill_title, fill_colors, plot_title) {\n  ggplot(map_data_repos) +\n    geom_sf(aes(fill = !!sym(fill_var)), color = \"white\", linewidth = 0.3) +\n    scale_fill_manual(\n      name = fill_title,\n      values = fill_colors,\n      na.value = \"gray90\",\n      na.translate = FALSE,\n      guide = guide_legend(\n        direction = \"vertical\",\n        title.position = \"top\",\n        title.hjust = 0.5\n      )\n    ) +\n    theme_void() +\n    labs(title = plot_title) +\n    theme(\n      plot.title = element_text(size = 25, face = \"bold\", hjust = 0.5, margin = margin(b = 5)),\n      legend.position = \"bottom\",\n      legend.title = element_text(size = 1, face = \"bold\"),\n      legend.text = element_text(size = 25),\n      legend.box = \"vertical\",\n      legend.margin = margin(t = 5, b = 0)\n    )\n}\n\n# Create the three maps\nmap_arrestee_repos <- create_policy_map(\n  \"arrestee_collection\", \" \",\n  c(\"yes\" = \"#1f77b4\", \"no\" = \"#666666\"), \n  \"A. Arrestee DNA Collection Policy\"\n)\n\nmap_familial_repos <- create_policy_map(\n  \"fam_search\", \" \",\n  c(\"permitted\" = \"#1f77b4\", \"prohibited\" = \"#000000ff\", \"unspecified\" = \"#666666\"),\n  \"B. Familial Search Policy\"\n)\n\nmap_foia_repos <- create_policy_map(\n  \"foia_availability\", \" \",\n  c(\"provided\" = \"#1f77b4\", \"not_provided\" = \"#666666\"),\n  \"C. FOIA Response Status\"\n)\n\n# Combine maps horizontally\nfigure_combined <- map_arrestee_repos | map_familial_repos | map_foia_repos\n\nfigure_combined + plot_annotation(\n  title = \" \",\n  theme = theme(plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5))\n)\n```\n\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/three-panel-map-1.png){width=1728}\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show three-panel map code\"}\n# Compute summary counts and percentages for each category\npolicy_summary <- sdis_data %>%\n  summarise(\n    `Arrestee Collection - Yes` = sum(arrestee_collection == \"yes\", na.rm = TRUE),\n    `Arrestee Collection - No` = sum(arrestee_collection == \"no\", na.rm = TRUE),\n    `Familial Search - Permitted` = sum(fam_search == \"permitted\", na.rm = TRUE),\n    `Familial Search - Prohibited` = sum(fam_search == \"prohibited\", na.rm = TRUE),\n    `Familial Search - Unspecified` = sum(fam_search == \"unspecified\", na.rm = TRUE),\n    `FOIA - Provided` = sum(foia_availability == \"provided\", na.rm = TRUE),\n    `FOIA - Not Provided` = sum(foia_availability == \"not_provided\", na.rm = TRUE)\n  ) %>%\n  pivot_longer(everything(), names_to = \"Metric\", values_to = \"Count\") %>%\n  mutate(\n    Group = case_when(\n      grepl(\"Arrestee Collection\", Metric) ~ \"Arrestee Collection\",\n      grepl(\"Familial Search\", Metric) ~ \"Familial Search\",\n      grepl(\"FOIA\", Metric) ~ \"FOIA Availability\"\n    ),\n    Percentage = round(Count / 50 * 100, 1)\n  )\n\n# Split into subtables by group\npolicy_tables <- policy_summary %>%\n  group_split(Group)\n\n# Create function to build consistent flextables\nmake_policy_table <- function(df) {\n  flextable(df %>% select(Metric, Count, Percentage)) %>%\n    theme_zebra() %>%\n    set_caption(paste0(unique(df$Group), \" (n = 50 states)\")) %>%\n    colformat_num(j = \"Percentage\", suffix = \"%\") %>%\n    align(align = \"left\", part = \"all\") %>%\n    bold(j = \"Metric\") %>%\n    fontsize(size = 10, part = \"all\") %>%\n    autofit()\n}\n\n# Build three subtables\nft_1 <- make_policy_table(policy_tables[[1]])\nft_2 <- make_policy_table(policy_tables[[2]])\nft_3 <- make_policy_table(policy_tables[[3]])\n\nft_1\n\nft_2\n\nft_3\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5dc7144e{}.cl-5dc46b68{font-family:'Helvetica';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dc46b72{font-family:'Helvetica';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dc58a3e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5dc594f2{width:1.929in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc594fc{width:0.686in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc594fd{width:1.034in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc594fe{width:1.929in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc59506{width:0.686in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc59507{width:1.034in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc59508{width:1.929in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc59509{width:0.686in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dc5950a{width:1.034in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5dc7144e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5dc594f2\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b68\">Metric</span></p></th><th class=\"cl-5dc594fc\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b68\">Count</span></p></th><th class=\"cl-5dc594fd\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b68\">Percentage</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dc594fe\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b68\">Arrestee Collection - Yes</span></p></td><td class=\"cl-5dc59506\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b72\">33</span></p></td><td class=\"cl-5dc59507\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b72\">66%</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dc59508\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b68\">Arrestee Collection - No</span></p></td><td class=\"cl-5dc59509\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b72\">17</span></p></td><td class=\"cl-5dc5950a\"><p class=\"cl-5dc58a3e\"><span class=\"cl-5dc46b72\">34%</span></p></td></tr></tbody></table></div>\n```\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5dcdeb70{}.cl-5dcb3b3c{font-family:'Helvetica';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dcb3b46{font-family:'Helvetica';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dcc547c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5dcc5f30{width:1.605in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f3a{width:0.686in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f3b{width:1.034in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f3c{width:1.605in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f3d{width:0.686in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f44{width:1.034in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f45{width:1.605in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f4e{width:0.686in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dcc5f4f{width:1.034in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5dcdeb70'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5dcc5f30\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b3c\">Metric</span></p></th><th class=\"cl-5dcc5f3a\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b3c\">Count</span></p></th><th class=\"cl-5dcc5f3b\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b3c\">Percentage</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dcc5f3c\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b3c\">FOIA - Provided</span></p></td><td class=\"cl-5dcc5f3d\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b46\">7</span></p></td><td class=\"cl-5dcc5f44\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b46\">14%</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dcc5f45\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b3c\">FOIA - Not Provided</span></p></td><td class=\"cl-5dcc5f4e\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b46\">43</span></p></td><td class=\"cl-5dcc5f4f\"><p class=\"cl-5dcc547c\"><span class=\"cl-5dcb3b46\">86%</span></p></td></tr></tbody></table></div>\n```\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5dd2dc5c{}.cl-5dd01918{font-family:'Helvetica';font-size:10pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dd01922{font-family:'Helvetica';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5dd13564{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5dd14108{width:2.215in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14112{width:0.686in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14113{width:1.034in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd1411c{width:2.215in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd1411d{width:0.686in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14126{width:1.034in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14127{width:2.215in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14128{width:0.686in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14130{width:1.034in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14131{width:2.215in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd14132{width:0.686in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5dd1413a{width:1.034in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5dd2dc5c'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5dd14108\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Metric</span></p></th><th class=\"cl-5dd14112\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Count</span></p></th><th class=\"cl-5dd14113\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Percentage</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dd1411c\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Familial Search - Permitted</span></p></td><td class=\"cl-5dd1411d\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">12</span></p></td><td class=\"cl-5dd14126\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">24%</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dd14127\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Familial Search - Prohibited</span></p></td><td class=\"cl-5dd14128\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">1</span></p></td><td class=\"cl-5dd14130\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">2%</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5dd14131\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01918\">Familial Search - Unspecified</span></p></td><td class=\"cl-5dd14132\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">37</span></p></td><td class=\"cl-5dd1413a\"><p class=\"cl-5dd13564\"><span class=\"cl-5dd01922\">74%</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n## Data Availability Overview\n\nAssess the completeness of data across states, including which states are missing and the availability of key fields.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show overview code\"}\n# Identify states present in the dataset\nstates_in_data <- unique(sdis_data$state) %>% sort()\n\n# Check if all 50 states are represented\nall_states <- c('Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut',\n                'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa',\n                'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan',\n                'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire',\n                'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio',\n                'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota',\n                'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia',\n                'Wisconsin', 'Wyoming')\n\nmissing_states <- setdiff(all_states, states_in_data)\nif (length(missing_states) > 0) {\n  cat(paste(\"\\nMissing states:\", paste(missing_states, collapse = \", \"), \"\\n\"))\n} else {\n  cat(\"\\nAll 50 states are represented in the dataset\\n\")\n}\n\n# Assess data completeness for each state\n# Improved heatmap with enhanced visualization\ndata_availability <- sdis_data %>%\n  filter(!is.na(state)) %>%  # Remove any rows with missing state names\n  group_by(state) %>%\n  summarise(across(everything(), ~sum(!is.na(.))), .groups = \"drop\") %>%\n  as.data.frame()\n\n# Set row names safely\nstate_names <- data_availability$state\ndata_availability <- data_availability %>% select(-state)\nrownames(data_availability) <- state_names\n\n# Generate visualization of data completeness\nkey_fields <- c('n_total', 'n_arrestees', 'n_offenders', 'n_forensic')\n\n# Filter to include only key fields that exist in the data\navailable_key_fields <- intersect(key_fields, names(data_availability))\n\nif (length(available_key_fields) > 0) {\n  availability_subset <- data_availability[, available_key_fields, drop = FALSE]\n  availability_binary <- as.data.frame(ifelse(availability_subset > 0, 1, 0))\n  \n  # Create heatmap data in long format\n  heatmap_long <- availability_binary %>%\n    rownames_to_column(\"state\") %>%\n    pivot_longer(cols = -state, names_to = \"field\", values_to = \"available\") %>%\n    mutate(\n      state = factor(state, levels = rownames(availability_binary)),\n      state = factor(state, levels = sort(unique(state), decreasing = TRUE)),\n      field = factor(field, levels = available_key_fields),\n      # Create labels with different symbols\n      label = case_when(\n        available == 1 ~ \"‚úì\",\n        available == 0 ~ \"!\",\n        TRUE ~ \"\"\n      ),\n      # Color coding for different values\n      fill_color = case_when(\n        available == 1 ~ \"Available\",\n        available == 0 ~ \"Missing\",\n        TRUE ~ \"Unknown\"\n      )\n    )\n  \n  # Create the enhanced heatmap\nggplot(heatmap_long, aes(x = field, y = state, fill = fill_color)) +\n  geom_tile(color = \"white\", linewidth = 0.8, width = 0.9, height = 0.9) +\n  geom_text(aes(label = label, color = fill_color), \n            size = 4, fontface = \"bold\", vjust = 0.8) +\n  scale_fill_manual(values = c(\n    \"Available\" = \"#2E86AB\",\n    \"Missing\" = \"#FF6B6B\",\n    \"Unknown\" = \"#f0f0f0\"\n  )) +\n  scale_color_manual(values = c(\n    \"Available\" = \"white\",\n    \"Missing\" = \"white\",\n    \"Unknown\" = \"gray30\"\n  )) +\n  labs(\n    title = \"Data Availability Heatmap by State\",\n    subtitle = \"‚úì = Data available | ! = Data missing (0 values)\",\n    x = NULL,\n    y = NULL,\n    fill = \"Data Status\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    axis.text.x.top = element_text(angle = 315, hjust = 0.5, face = \"bold\"), \n    axis.text.y = element_text(face = \"bold\"),\n    axis.title.y = element_text(face = \"bold\", vjust = 0),\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 16),\n    plot.subtitle = element_text(hjust = 0.5, color = \"gray40\", size = 10),\n    panel.grid = element_blank(),\n    legend.position = \"top\",\n    legend.title = element_text(face = \"bold\"),\n    axis.ticks.x = element_line(),\n    axis.ticks.x.top = element_line()\n  ) +\n  guides(color = \"none\") +\n  coord_fixed() +\n  scale_x_discrete(position = \"top\")\n  \n} else {\n  message(\"No key fields available for heatmap visualization\")\n}\n```\n\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/overview-data-1.png){width=960}\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show overview code\"}\n# Data coverage summary\ncat(\"\\nData field coverage across states:\\n\")\n\nkey_fields <- c('n_total', 'n_arrestees', 'n_offenders', 'n_forensic', 'fam_search', 'collection_statute')\n\nfor (col in key_fields) {\n  if (col %in% names(sdis_data)) {\n    states_with_data <- sum(!is.na(sdis_data[[col]]))\n    coverage_pct <- states_with_data / length(states_in_data) * 100\n    cat(paste0(col, \": \", states_with_data, \" states (\", round(coverage_pct, 1), \"%)\\n\"))\n  }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nAll 50 states are represented in the dataset\n\nData field coverage across states:\nn_total: 29 states (58%)\nn_arrestees: 25 states (50%)\nn_offenders: 18 states (36%)\nn_forensic: 12 states (24%)\nfam_search: 50 states (100%)\ncollection_statute: 50 states (100%)\n```\n\n\n:::\n:::\n\n\n## Total Profile Calculations Verification\n\nThis section examines states reporting n_total alongside component counts to determine whether totals represent:\n\n1. Sum of all profile types including forensic (n_arrestees + n_offenders + n_forensic)\n\n2. Sum of combined profiles only (n_arrestees + n_offenders)\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show calculations code\"}\n# Identify states with n_total and at least one component count\n# First ensure all numeric columns are properly typed\nstates_with_totals <- sdis_data %>%\n  mutate(\n    n_arrestees = as.numeric(n_arrestees),\n    n_offenders = as.numeric(n_offenders),\n    n_forensic = as.numeric(n_forensic),\n    n_total = as.numeric(n_total)\n  ) %>%\n  filter(!is.na(n_total)) %>%\n  mutate(\n    # Calculate sums\n    sum_all = rowSums(cbind(n_arrestees, n_offenders, n_forensic), na.rm = TRUE),\n    sum_arrestees_offenders = rowSums(cbind(n_arrestees, n_offenders), na.rm = TRUE),\n    # Check if all components are available\n    all_components_available = !is.na(n_arrestees) & !is.na(n_offenders) & !is.na(n_forensic),\n    both_arrestees_offenders = !is.na(n_arrestees) & !is.na(n_offenders)\n  )\n\n# Check matches with tolerance\ntolerance <- 10\n\nstates_with_totals <- states_with_totals %>%\n  mutate(\n    matches_combined_forensic = ifelse(\n      all_components_available,\n      abs(n_total - sum_all) <= tolerance,\n      FALSE\n    ),\n    matches_combined = ifelse(\n      both_arrestees_offenders,\n      (abs(n_total - sum_arrestees_offenders) <= tolerance) & \n        (n_arrestees > 0),\n      FALSE\n    )\n  )\n\n# Filter to states with at least one component count\nhas_components <- states_with_totals %>%\n  filter(!is.na(n_arrestees) | !is.na(n_offenders) | !is.na(n_forensic))\n\ncat(paste(\"States with n_total and component data:\", nrow(has_components), \"\\n\"))\ncat(\"\\nTotal calculation patterns:\\n\")\n\n# Categorize states\nincludes_all <- has_components %>% filter(matches_combined_forensic) %>% pull(state)\nforensic_only <- has_components %>% filter(matches_combined & !matches_combined_forensic) %>% pull(state)\nneither <- has_components %>% filter(!matches_combined_forensic & !matches_combined) %>% pull(state)\n\nif (length(includes_all) > 0) {\n  cat(\"\\nn_total matches combined profiles with forensic (arrestees + offenders + forensic):\\n\")\n  for (state in includes_all) {\n    cat(paste(\"  ‚Ä¢\", state, \"\\n\"))\n  }\n} else {\n  cat(\"\\nStates where n_total matches the sum of arrestees + offenders + forensic: None\\n\")\n}\n\nif (length(forensic_only) > 0) {\n  cat(\"\\nStates where n_total includes combined profiles only (arrestees + offenders):\\n\")\n  for (state in forensic_only) {\n    cat(paste(\"  ‚Ä¢\", state, \"\\n\"))\n  }\n}\n\nif (length(neither) > 0) {\n  cat(\"\\nStates where n_total does not match calculated sums:\\n\")\n  for (state in neither) {\n    state_data <- has_components %>% filter(state == !!state)\n    cat(paste0(\"  ‚Ä¢ \", state, \":\\n n_total=\", format(state_data$n_total, big.mark = \",\"), \n               \"\\n Sum_all=\", format(state_data$sum_all, big.mark = \",\"),\n               \"\\n Sum_arrestees_offenders =\", format(state_data$sum_arrestees_offenders, big.mark = \",\"), \"\\n\\n\"))\n  }\n}\n\n# Display detailed breakdown\ncat(\"\\nDetailed breakdown:\\n\")\nhas_components %>%\n  select(state, n_total, n_arrestees, n_offenders, n_forensic, matches_combined_forensic, matches_combined) %>%\n  mutate(across(where(is.numeric), ~ifelse(is.na(.), \"\", format(., big.mark = \",\")))) %>%\n  flextable()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStates with n_total and component data: 19 \n\nTotal calculation patterns:\n\nn_total matches combined profiles with forensic (arrestees + offenders + forensic):\n  ‚Ä¢ West Virginia \n\nStates where n_total includes combined profiles only (arrestees + offenders):\n  ‚Ä¢ Alaska \n  ‚Ä¢ Indiana \n  ‚Ä¢ Rhode Island \n  ‚Ä¢ Tennessee \n  ‚Ä¢ Wisconsin \n\nStates where n_total does not match calculated sums:\n  ‚Ä¢ California:\n n_total=3,365,402\n Sum_all=167,053\n Sum_arrestees_offenders =0\n\n  ‚Ä¢ Connecticut:\n n_total=135,006\n Sum_all=158,206\n Sum_arrestees_offenders =135,006\n\n  ‚Ä¢ Georgia:\n n_total=347,145\n Sum_all=347,145\n Sum_arrestees_offenders =324,864\n\n  ‚Ä¢ Idaho:\n n_total=39,000\n Sum_all=39,000\n Sum_arrestees_offenders =39,000\n\n  ‚Ä¢ Illinois:\n n_total=689,297\n Sum_all=759,224\n Sum_arrestees_offenders =689,297\n\n  ‚Ä¢ Maryland:\n n_total=194,803\n Sum_all=147,803\n Sum_arrestees_offenders =147,803\n\n  ‚Ä¢ Minnesota:\n n_total=180,000\n Sum_all=180,000\n Sum_arrestees_offenders =180,000\n\n  ‚Ä¢ Missouri:\n n_total=4e+05\n Sum_all=386,000\n Sum_arrestees_offenders =386,000\n\n  ‚Ä¢ Montana:\n n_total=32,284\n Sum_all=33,162\n Sum_arrestees_offenders =32,284\n\n  ‚Ä¢ North Carolina:\n n_total=380,000\n Sum_all=350,000\n Sum_arrestees_offenders =350,000\n\n  ‚Ä¢ South Carolina:\n n_total=175,629\n Sum_all=186,756\n Sum_arrestees_offenders =175,629\n\n  ‚Ä¢ Texas:\n n_total=1,342,285\n Sum_all=1,342,285\n Sum_arrestees_offenders =1,342,285\n\n  ‚Ä¢ Washington:\n n_total=272,000\n Sum_all=280,800\n Sum_arrestees_offenders =272,000\n\n\nDetailed breakdown:\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-5e8571c8{}.cl-5e82683e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-5e8391f0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5e8391f1{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-5e839db2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5e839dbc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5e839dbd{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5e839dc6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5e839dc7{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-5e839dc8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-5e8571c8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-5e839db2\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">state</span></p></th><th class=\"cl-5e839db2\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">n_total</span></p></th><th class=\"cl-5e839db2\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">n_arrestees</span></p></th><th class=\"cl-5e839db2\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">n_offenders</span></p></th><th class=\"cl-5e839db2\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">n_forensic</span></p></th><th class=\"cl-5e839dbc\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">matches_combined_forensic</span></p></th><th class=\"cl-5e839dbc\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">matches_combined</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Alaska</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   79,146</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 52,149</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   26,997</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  3,866</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">California</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">3,365,402</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">167,053</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Connecticut</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  135,006</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  135,006</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 23,200</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Georgia</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  347,145</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  324,864</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 22,281</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Idaho</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   39,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">      0</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   39,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Illinois</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  689,297</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  689,297</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 69,927</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Indiana</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  479,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">169,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  310,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 23,700</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Maryland</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  194,803</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  5,525</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  142,278</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Minnesota</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  180,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  180,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Missouri</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  400,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  386,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Montana</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   32,284</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">      0</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   32,284</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">    878</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">North Carolina</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  380,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 50,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  300,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Rhode Island</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   27,818</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">    484</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   27,334</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  1,798</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">South Carolina</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  175,629</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  175,629</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 11,127</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Tennessee</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  518,614</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">226,569</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  292,045</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Texas</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">1,342,285</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">1,342,285</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"></span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Washington</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  272,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">      0</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  272,000</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  8,800</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">West Virginia</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   51,349</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">      0</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">   47,444</span></p></td><td class=\"cl-5e839dbd\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  3,905</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td><td class=\"cl-5e839dc6\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-5e839dc7\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">Wisconsin</span></p></td><td class=\"cl-5e839dc7\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  358,611</span></p></td><td class=\"cl-5e839dc7\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 23,717</span></p></td><td class=\"cl-5e839dc7\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\">  334,894</span></p></td><td class=\"cl-5e839dc7\"><p class=\"cl-5e8391f0\"><span class=\"cl-5e82683e\"> 24,756</span></p></td><td class=\"cl-5e839dc8\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">false</span></p></td><td class=\"cl-5e839dc8\"><p class=\"cl-5e8391f1\"><span class=\"cl-5e82683e\">true</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n## Analysis of Database Totals and Data Quality Issues\n\nExamine states where N_total values reveal potential data quality issues or reporting inconsistencies.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show data quality assessment code\"}\n# Create enhanced data quality analysis\nsdis_enhanced <- sdis_data %>%\n  mutate(\n    # Ensure all numeric columns are properly typed\n    n_total = as.numeric(n_total),\n    n_offenders = as.numeric(n_offenders),\n    n_arrestees = as.numeric(n_arrestees),\n    n_forensic = as.numeric(n_forensic)\n  ) %>%\n  rename(n_total_reported = n_total)\n\n# Calculate different total relationships with small tolerance\ntolerance <- 10\n\nsdis_enhanced <- sdis_enhanced %>%\n  mutate(\n    total_equals_offenders = ifelse(\n      !is.na(n_total_reported) & !is.na(n_offenders) & n_offenders > 0,\n      abs(n_total_reported - n_offenders) <= tolerance,\n      FALSE\n    ),\n    total_equals_off_arr = ifelse(\n      !is.na(n_total_reported) & !is.na(n_offenders) & !is.na(n_arrestees) &\n        n_offenders > 0 & n_arrestees > 0,\n      abs(n_total_reported - (n_offenders + n_arrestees)) <= tolerance,\n      FALSE\n    ),\n    total_equals_all = ifelse(\n      !is.na(n_total_reported) & !is.na(n_offenders) & !is.na(n_arrestees) & \n        !is.na(n_forensic) & n_offenders > 0 & n_arrestees > 0 & n_forensic > 0,\n      abs(n_total_reported - (n_offenders + n_arrestees + n_forensic)) <= tolerance,\n      FALSE\n    ),\n    total_method = case_when(\n      total_equals_all ~ \"All components\",\n      total_equals_off_arr ~ \"Offenders + Arrestees\",\n      total_equals_offenders ~ \"Offenders only\",\n      TRUE ~ \"Unknown\"\n    )\n  )\n\n# Create n_total_estimated based on the rules specified\nsdis_enhanced <- sdis_enhanced %>%\n  mutate(\n    n_total_estimated = NA_real_,\n    n_total_estimated_comment = \"\"\n  )\n\n# Rule 1: States where n_total == n_offenders + n_arrestees\nmask_off_arr <- sdis_enhanced$total_equals_off_arr\nsdis_enhanced$n_total_estimated[mask_off_arr] <- sdis_enhanced$n_total_reported[mask_off_arr]\nsdis_enhanced$n_total_estimated_comment[mask_off_arr] <- \"Used reported total (matches offenders + arrestees)\"\n\n# Rule 2: States where n_total == n_offenders + n_arrestees + n_forensic\nmask_all <- sdis_enhanced$total_equals_all\nsdis_enhanced$n_total_estimated[mask_all] <- sdis_enhanced$n_total_reported[mask_all] - sdis_enhanced$n_forensic[mask_all]\nsdis_enhanced$n_total_estimated_comment[mask_all] <- \"Subtracted forensic from reported total\"\n\n# Rule 3: States where n_total == n_offenders\nmask_off_only <- sdis_enhanced$total_equals_offenders\nsdis_enhanced$n_total_estimated[mask_off_only] <- sdis_enhanced$n_total_reported[mask_off_only]\nsdis_enhanced$n_total_estimated_comment[mask_off_only] <- \"Used reported total (matches offenders only)\"\n\n# Rule 4: For remaining states with n_total\nmask_total_only <- !is.na(sdis_enhanced$n_total_reported) & \n  is.na(sdis_enhanced$n_total_estimated) &\n  (is.na(sdis_enhanced$n_arrestees) | sdis_enhanced$n_arrestees == 0) &\n  (is.na(sdis_enhanced$n_offenders) | sdis_enhanced$n_offenders == 0) &\n  (is.na(sdis_enhanced$n_forensic) | sdis_enhanced$n_forensic == 0)\n\nsdis_enhanced$n_total_estimated[mask_total_only] <- sdis_enhanced$n_total_reported[mask_total_only]\nsdis_enhanced$n_total_estimated_comment[mask_total_only] <- \"Total only reported (no breakdown available)\"\n\n# Special case: States with n_total and n_forensic only\nmask_total_forensic_only <- !is.na(sdis_enhanced$n_total_reported) & \n  is.na(sdis_enhanced$n_total_estimated) &\n  (is.na(sdis_enhanced$n_arrestees) | sdis_enhanced$n_arrestees == 0) &\n  (is.na(sdis_enhanced$n_offenders) | sdis_enhanced$n_offenders == 0) &\n  !is.na(sdis_enhanced$n_forensic) & sdis_enhanced$n_forensic > 0\n\nsdis_enhanced$n_total_estimated[mask_total_forensic_only] <- sdis_enhanced$n_total_reported[mask_total_forensic_only]\nsdis_enhanced$n_total_estimated_comment[mask_total_forensic_only] <- \"Total only reported (forensic reported separately)\"\n\n# States with total and some components but unclear calculation\nmask_has_total_unclear <- !is.na(sdis_enhanced$n_total_reported) & is.na(sdis_enhanced$n_total_estimated)\nsdis_enhanced$n_total_estimated[mask_has_total_unclear] <- sdis_enhanced$n_total_reported[mask_has_total_unclear]\nsdis_enhanced$n_total_estimated_comment[mask_has_total_unclear] <- \"Total with discrepancy (calculation unclear)\"\n\n# For states without any total but with offenders and arrestees\nmask_no_total <- is.na(sdis_enhanced$n_total_reported) & \n  !is.na(sdis_enhanced$n_offenders) & sdis_enhanced$n_offenders > 0 &\n  !is.na(sdis_enhanced$n_arrestees) & sdis_enhanced$n_arrestees > 0\n\nsdis_enhanced$n_total_estimated[mask_no_total] <- sdis_enhanced$n_offenders[mask_no_total] + sdis_enhanced$n_arrestees[mask_no_total]\nsdis_enhanced$n_total_estimated_comment[mask_no_total] <- \"Calculated from offenders + arrestees (no total reported)\"\n\n# For states without total but with only offenders > 0\nmask_no_total_off_only <- is.na(sdis_enhanced$n_total_reported) & \n  !is.na(sdis_enhanced$n_offenders) & sdis_enhanced$n_offenders > 0 &\n  (is.na(sdis_enhanced$n_arrestees) | sdis_enhanced$n_arrestees == 0)\n\nsdis_enhanced$n_total_estimated[mask_no_total_off_only] <- sdis_enhanced$n_offenders[mask_no_total_off_only]\nsdis_enhanced$n_total_estimated_comment[mask_no_total_off_only] <- \"Used offenders count (no total reported, no arrestee data)\"\n\n# Create enhanced data availability matrix with better visualization\navailability_matrix <- sdis_enhanced %>%\n  transmute(\n    State = state,\n    Arrestees = ifelse(!is.na(n_arrestees) & n_arrestees > 0, \"‚úì\", \"!\"),\n    Offenders = ifelse(!is.na(n_offenders) & n_offenders > 0, \"‚úì\", \"!\"),\n    Forensic = ifelse(!is.na(n_forensic) & n_forensic > 0, \"‚úì\", \"!\"),\n    `Total Reported` = ifelse(!is.na(n_total_reported), \"‚úì\", \"!\"),\n    `Total Method` = case_when(\n      total_method == \"Offenders only\" ~ \"O\",\n      total_method == \"Offenders + Arrestees\" ~ \"O+A\",\n      total_method == \"All components\" ~ \"All\",\n      TRUE ~ \"?\"\n    )\n  )\n\n# Convert to long format for ggplot\navailability_long <- availability_matrix %>%\n  pivot_longer(cols = -State, names_to = \"Field\", values_to = \"Value\") %>%\n  mutate(\n    State = factor(State, levels = sort(unique(State), decreasing = TRUE)),\n    Field = factor(Field, levels = c(\"Arrestees\", \"Offenders\", \"Forensic\", \"Total Reported\", \"Total Method\")),\n    # Create numeric values for coloring\n    NumericValue = case_when(\n      Value == \"‚úì\" ~ 1,\n      Value == \"!\" ~ 0,\n      Value == \"O\" ~ 2,\n      Value == \"O+A\" ~ 3,\n      Value == \"All\" ~ 4,\n      Value == \"?\" ~ 0,\n      TRUE ~ 0\n    ),\n    # Create display labels\n    DisplayLabel = case_when(\n      Field == \"Total Method\" & Value == \"?\" ~ \"?\",\n      Field == \"Total Method\" ~ Value,\n      TRUE ~ Value\n    )\n  )\n\n# Summary of how n_total_estimated was calculated\ncat(\"n_total_estimated Column Calculation Summary:\\n\")\ncat(\"=\", strrep(\"=\", 48), \"\\n\", sep = \"\")\n\n# Group states by how their n_total_estimated was determined\nestimation_groups <- sdis_enhanced %>%\n  group_by(n_total_estimated_comment) %>%\n  summarise(\n    states = list(state),\n    count = n(),\n    .groups = \"drop\"\n  ) %>%\n  arrange(desc(count))\n\n# Print summary in organized sections\ncat(\"\\n1. States with n_total reported and matching patterns:\\n\")\nmatching_patterns <- estimation_groups %>%\n  filter(str_detect(n_total_estimated_comment, \"matches|Subtracted\"))\nfor (i in 1:nrow(matching_patterns)) {\n  group <- matching_patterns[i, ]\n  cat(sprintf(\"   ‚Ä¢ %s: %d states \\n(%s)\\n\", \n              group$n_total_estimated_comment, \n              group$count,\n              paste(unlist(group$states), collapse = \", \")))\n}\n\ncat(\"\\n2. States with only n_total reported (no breakdown):\\n\")\ntotal_only <- estimation_groups %>%\n  filter(str_detect(n_total_estimated_comment, \"Total only reported\"))\nfor (i in 1:nrow(total_only)) {\n  group <- total_only[i, ]\n  cat(sprintf(\"   ‚Ä¢ %s: %d states \\n(%s)\\n\", \n              group$n_total_estimated_comment, \n              group$count,\n              paste(unlist(group$states), collapse = \", \")))\n}\n\ncat(\"\\n3. States without n_total reported (calculated):\\n\")\ncalculated <- estimation_groups %>%\n  filter(str_detect(n_total_estimated_comment, \"Calculated|Used offenders count\"))\nfor (i in 1:nrow(calculated)) {\n  group <- calculated[i, ]\n  cat(sprintf(\"   ‚Ä¢ %s: %d states (%s)\\n\", \n              group$n_total_estimated_comment, \n              group$count,\n              paste(unlist(group$states), collapse = \", \")))\n}\n\ncat(\"\\n4. States with unclear calculation patterns:\\n\")\nunclear <- estimation_groups %>%\n  filter(str_detect(n_total_estimated_comment, \"discrepancy|unclear\"))\nfor (i in 1:nrow(unclear)) {\n  group <- unclear[i, ]\n  cat(sprintf(\"   ‚Ä¢ %s: %d states (%s)\\n\", \n              group$n_total_estimated_comment, \n              group$count,\n              paste(unlist(group$states), collapse = \", \")))\n  \n  # Show details for unclear states\n  unclear_states <- sdis_enhanced %>% \n    filter(state %in% unlist(group$states)) %>%\n    select(state, n_total_reported, n_offenders, n_arrestees, n_forensic)\n  \n  for (j in 1:nrow(unclear_states)) {\n    s <- unclear_states[j, ]\n    cat(sprintf(\"      - %s: Total=%s, Offenders=%s, Arrestees=%s, Forensic=%s\\n\",\n                s$state, \n                format(s$n_total_reported %||% 0, big.mark = \",\"),\n                format(s$n_offenders %||% 0, big.mark = \",\"),\n                format(s$n_arrestees %||% 0, big.mark = \",\"),\n                format(s$n_forensic %||% 0, big.mark = \",\")))\n  }\n}\n\n# Create enhanced heatmap with legend at top and x-labels on both top and bottom\np <- ggplot(availability_long, aes(x = Field, y = State, fill = factor(NumericValue))) +\n  geom_tile(color = \"white\", linewidth = 0.8, width = 0.9, height = 0.9) +\n  geom_text(aes(label = DisplayLabel, color = factor(NumericValue)), \n            size = 3.5, fontface = \"bold\", vjust = 0.8) +\n  scale_fill_manual(\n    name = \"Legend\",\n    values = c(\n      \"0\" = \"#FF6B6B\",      # Red/Orange for missing/unknown\n      \"1\" = \"#2E86AB\",      # Blue for available\n      \"2\" = \"#4ECDC4\",      # Teal for Offenders only\n      \"3\" = \"#45B7D1\",      # Light blue for Offenders + Arrestees\n      \"4\" = \"#1A535C\"       # Dark teal for All components\n    ),\n    labels = c(\n      \"0\" = \"Missing/Unknown data\",\n      \"1\" = \"Data available\",\n      \"2\" = \"Total = Offenders only\",\n      \"3\" = \"Total = Offenders + Arrestees\",\n      \"4\" = \"Total = All components\"\n    )\n  ) +\n  scale_color_manual(values = c(\n    \"0\" = \"white\",        # White text on red\n    \"1\" = \"white\",        # White text on blue\n    \"2\" = \"white\",        # White text on teal\n    \"3\" = \"white\",        # White text on light blue\n    \"4\" = \"white\"         # White text on dark teal\n  )) +\n  labs(\n    title = \" \",\n    x = \"\", \n    y = \"\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    axis.text.x.top = element_text(angle = 315, hjust = 0.5, face = \"bold\"),\n    axis.text.y = element_text(face = \"bold\"),\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 14),\n    plot.subtitle = element_text(hjust = 0.5, color = \"gray40\", size = 9),\n    panel.grid = element_blank(),\n    legend.position = \"top\",\n    legend.title = element_text(face = \"bold\"),\n    legend.text = element_text(size = 9),\n    axis.ticks.x = element_line(),\n    axis.ticks.x.top = element_line()\n  ) +\n  guides(color = \"none\") +\n  coord_fixed() +\n  scale_x_discrete(position = \"top\")\n\n# Update the main dataframe for subsequent analyses\nsdis_data <- sdis_enhanced\n\n# Helper function for null coalescing\n`%||%` <- function(a, b) if (!is.null(a) && !is.na(a)) a else b\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nn_total_estimated Column Calculation Summary:\n=================================================\n\n1. States with n_total reported and matching patterns:\n   ‚Ä¢ Used reported total (matches offenders only): 8 states \n(Connecticut, Idaho, Illinois, Minnesota, Montana, South Carolina, Texas, Washington)\n   ‚Ä¢ Used reported total (matches offenders + arrestees): 5 states \n(Alaska, Indiana, Rhode Island, Tennessee, Wisconsin)\n\n2. States with only n_total reported (no breakdown):\n   ‚Ä¢ Total only reported (no breakdown available): 10 states \n(Alabama, Arkansas, Colorado, Florida, Louisiana, Mississippi, Nevada, New Jersey, South Dakota, Virginia)\n   ‚Ä¢ Total only reported (forensic reported separately): 1 states \n(California)\n\n3. States without n_total reported (calculated):\n   ‚Ä¢ NA: NA states ()\n\n4. States with unclear calculation patterns:\n   ‚Ä¢ Total with discrepancy (calculation unclear): 5 states (Georgia, Maryland, Missouri, North Carolina, West Virginia)\n      - Georgia: Total=347,145, Offenders=324,864, Arrestees=NA, Forensic=22,281\n      - Maryland: Total=194,803, Offenders=142,278, Arrestees=5,525, Forensic=NA\n      - Missouri: Total=4e+05, Offenders=386,000, Arrestees=NA, Forensic=NA\n      - North Carolina: Total=380,000, Offenders=3e+05, Arrestees=50,000, Forensic=NA\n      - West Virginia: Total=51,349, Offenders=47,444, Arrestees=0, Forensic=3,905\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/unnamed-chunk-1-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show summary visualization code\"}\n# Create summary data\nsummary_data <- sdis_data %>%\n  mutate(\n    data_category = case_when(\n      str_detect(n_total_estimated_comment, \"matches offenders only\") ~ \"Matches Offenders Only\",\n      str_detect(n_total_estimated_comment, \"matches offenders \\\\+ arrestees\") ~ \"Matches Offenders + Arrestees\",\n      str_detect(n_total_estimated_comment, \"Total only reported \\\\(no breakdown\\\\)\") ~ \"Total Only (No Breakdown)\",\n      str_detect(n_total_estimated_comment, \"Total only reported \\\\(forensic\") ~ \"Total Only (Forensic Separate)\",\n      str_detect(n_total_estimated_comment, \"Calculated from offenders \\\\+ arrestees\") ~ \"Calculated (Offenders + Arrestees)\",\n      str_detect(n_total_estimated_comment, \"Used offenders count\") ~ \"Calculated (Offenders Only)\",\n      str_detect(n_total_estimated_comment, \"discrepancy|unclear\") ~ \"Unclear Calculation\",\n      TRUE ~ \"Other\"\n    ),\n    has_arrestees = !is.na(n_arrestees) & n_arrestees > 0,\n    has_offenders = !is.na(n_offenders) & n_offenders > 0,\n    has_forensic = !is.na(n_forensic) & n_forensic > 0,\n    has_total_reported = !is.na(n_total_reported)\n  )\n\n# Create a summary table by category\ncategory_summary <- summary_data %>%\n  group_by(data_category) %>%\n  summarise(\n    count = n(),\n    states = paste(sort(state), collapse = \", \"),\n    avg_total = mean(n_total_estimated, na.rm = TRUE),\n    median_total = median(n_total_estimated, na.rm = TRUE),\n    .groups = \"drop\"\n  ) %>%\n  arrange(desc(count))\n\n# Print summary statistics\ncat(\"SUMMARY STATISTICS\\n\")\ncat(\"=================\\n\\n\")\n\ncat(\"Calculation Methods Distribution:\\n\")\nfor (i in 1:nrow(category_summary)) {\n  cat(sprintf(\"\\n%s: %d states (%s)\\n\", \n              category_summary$data_category[i], \n              category_summary$count[i],\n              category_summary$states[i]))\n}\n\ncat(\"\\nOverall Data Availability:\\n\")\ncat(sprintf(\"States with arrestee data: %d\\n\", sum(summary_data$has_arrestees)))\ncat(sprintf(\"States with offender data: %d\\n\", sum(summary_data$has_offenders)))\ncat(sprintf(\"States with forensic data: %d\\n\", sum(summary_data$has_forensic)))\ncat(sprintf(\"States with total reported: %d\\n\", sum(summary_data$has_total_reported)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSUMMARY STATISTICS\n=================\n\nCalculation Methods Distribution:\n\nOther: 31 states (Alabama, Arizona, Arkansas, Colorado, Delaware, Florida, Hawaii, Iowa, Kansas, Kentucky, Louisiana, Maine, Massachusetts, Michigan, Mississippi, Nebraska, Nevada, New Hampshire, New Jersey, New Mexico, New York, North Dakota, Ohio, Oklahoma, Oregon, Pennsylvania, South Dakota, Utah, Vermont, Virginia, Wyoming)\n\nMatches Offenders Only: 8 states (Connecticut, Idaho, Illinois, Minnesota, Montana, South Carolina, Texas, Washington)\n\nMatches Offenders + Arrestees: 5 states (Alaska, Indiana, Rhode Island, Tennessee, Wisconsin)\n\nUnclear Calculation: 5 states (Georgia, Maryland, Missouri, North Carolina, West Virginia)\n\nTotal Only (Forensic Separate): 1 states (California)\n\nOverall Data Availability:\nStates with arrestee data: 7\nStates with offender data: 18\nStates with forensic data: 12\nStates with total reported: 29\n```\n\n\n:::\n:::\n\n\n## Stacked Bar Chart: DNA Profile Composition by State\n\nThis visualization shows the composition of DNA profiles across states, with separate colors for offender, arrestee, and forensic profiles. States without detailed breakdowns show total counts (reported or calculated).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show stacked bar chart code\"}\n# Prepare data for stacked bar chart\nbar_data <- sdis_data %>%\n  mutate(\n    # Determine if state has detailed breakdown\n    has_breakdown = (!is.na(n_offenders) & n_offenders > 0) | \n                    (!is.na(n_arrestees) & n_arrestees > 0) | \n                    (!is.na(n_forensic) & n_forensic > 0),\n    \n    # For states with breakdown, use actual values\n    offenders_display = ifelse(has_breakdown & !is.na(n_offenders), n_offenders, 0),\n    arrestees_display = ifelse(has_breakdown & !is.na(n_arrestees), n_arrestees, 0),\n    forensic_display = ifelse(has_breakdown & !is.na(n_forensic), n_forensic, 0),\n    \n    # For states without breakdown, use total\n    total_reported_display = ifelse(!has_breakdown & !is.na(n_total_reported), \n                                    n_total_reported, 0),\n    total_calculated_display = ifelse(!has_breakdown & is.na(n_total_reported) & \n                                      !is.na(n_total_estimated), \n                                      n_total_estimated, 0)\n  ) %>%\n  filter(!is.na(n_total_estimated) | has_breakdown) %>%\n  select(state, offenders_display, arrestees_display, forensic_display, \n         total_reported_display, total_calculated_display) %>%\n  pivot_longer(cols = -state, names_to = \"profile_type\", values_to = \"count\") %>%\n  filter(count > 0) %>%\n  mutate(\n    profile_type = factor(profile_type, \n                         levels = c(\"offenders_display\", \"arrestees_display\", \n                                   \"forensic_display\", \"total_reported_display\", \n                                   \"total_calculated_display\"),\n                         labels = c(\"Offender Profiles\", \"Arrestee Profiles\", \n                                   \"Forensic Profiles\", \"Total (Reported)\", \n                                   \"Total (Calculated)\"))\n  )\n\n# Calculate total for ordering states\nstate_totals <- bar_data %>%\n  group_by(state) %>%\n  summarise(total = sum(count, na.rm = TRUE), .groups = \"drop\") %>%\n  arrange(desc(total))\n\n# Reorder states by total count\nbar_data <- bar_data %>%\n  mutate(state = factor(state, levels = state_totals$state))\n\n# Create custom label function for y-axis\nlabel_k_m <- function(x) {\n  ifelse(x >= 1e6, \n         paste0(round(x / 1e6, 1), \"M\"),\n         ifelse(x >= 1e3,\n                paste0(round(x / 1e3, 0), \"k\"),\n                as.character(x)))\n}\n\n# Create stacked bar chart\n# Create stacked bar chart\nggplot(bar_data, aes(x = state, y = count, fill = profile_type)) +\n  geom_bar(stat = \"identity\", width = 0.8, color = \"white\", linewidth = 0.2) +\n  scale_fill_manual(\n    name = \"Profile Type\",\n    values = c(\n      \"Offender Profiles\" = \"#2E86AB\",\n      \"Arrestee Profiles\" = \"#F9A03F\",\n      \"Forensic Profiles\" = \"#2ca02c\",\n      \"Total (Reported)\" = \"#CCCCCC\",\n      \"Total (Calculated)\" = \"#808080\"\n    )\n  ) +\n  scale_y_continuous(\n    labels = label_k_m,\n    breaks = seq(0, max(bar_data %>% group_by(state) %>% summarise(total = sum(count)) %>% pull(total), na.rm = TRUE), \n                 by = 250000)\n  ) +\n  labs(\n    title = \" \",\n    x = NULL,\n    y = \"Number of Profiles\"\n  ) +\n  theme_minimal(base_size = 11) +\n  theme(\n    axis.text.x = element_text(angle = 90, hjust = 0, size = 15, vjust = 0, margin = margin(t = 0)),\n    axis.text.y = element_text(size = 15, margin = margin(t = 0)),\n    plot.title = element_text(face = \"bold\", hjust = 0.5, size = 18),\n    legend.position = \"top\",\n    legend.spacing.x = unit(1, \"cm\"),\n    legend.spacing.y = unit(0.2, \"cm\"),\n    legend.box.spacing = unit(0.2, \"cm\"),\n    legend.text = element_text(size = 15),\n    legend.title = element_text(face = \"bold\", size = 18),\n    axis.title.x = element_text(size = 18, margin = margin(t = 10)),\n    axis.title.y = element_text(size = 18, margin = margin(r = 10)),\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor = element_blank()\n  ) +\n  guides(fill = guide_legend(nrow = 3, byrow = TRUE))\n```\n\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/stacked-bar-chart-1.png){width=1344}\n:::\n:::\n\n\n## Export Enhanced Dataset\n\nExport the enhanced dataset with the new n_total_estimated values and documentation.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show exportation code\"}\n# Prepare final dataset with key columns in logical order\nfinal_columns <- c(\n  'state', \n  'n_total_estimated',\n  'n_total_reported',\n  'n_total_estimated_comment',\n  'total_method',\n  'n_arrestees', \n  'n_offenders', \n  'n_forensic',\n  'arrestee_collection',\n  'fam_search',\n  'collection_statute'\n)\n\n# Select columns that exist in the dataset\navailable_columns <- intersect(final_columns, names(sdis_enhanced))\nsdis_final <- sdis_enhanced %>% select(all_of(available_columns))\n\n# Export to CSV\noutput_relative <- file.path(\"data\", \"sdis\", \"final\", \"SDIS_cross_section.csv\")\noutput_path <- here(output_relative)\nwrite_csv(sdis_final, output_path)\ncat(paste(\"Exported enhanced SDIS dataset to:\", output_relative, \"\\n\"))\n\n# Display final summary statistics\ncat(\"\\n\\nFinal Summary Statistics:\\n\")\ncat(\"=\", strrep(\"=\", 48), \"\\n\", sep = \"\")\ncat(paste(\"Total states in dataset:\", nrow(sdis_final), \"\\n\"))\ncat(paste(\"States with n_total_estimated:\", sum(!is.na(sdis_final$n_total_estimated)), \"\\n\"))\ncat(paste(\"States with n_total_reported:\", sum(!is.na(sdis_final$n_total_reported)), \"\\n\"))\ncat(paste(\"Total profiles (estimated):\", format(sum(sdis_final$n_total_estimated, na.rm = TRUE), big.mark = \",\"), \"\\n\"))\n\n# Prepare the data for the interactive table\nsummary_table <- sdis_data %>%\n  select(state, n_total_estimated, n_total_reported, n_offenders, n_arrestees, \n         n_forensic, n_total_estimated_comment) %>%\n  mutate(across(where(is.numeric), ~ifelse(is.na(.), NA, format(., big.mark = \",\", scientific = FALSE))))\n\n# Create interactive table\ndatatable(\n  summary_table,\n  extensions = c('Buttons', 'ColReorder', 'Scroller'),\n  options = list(\n    dom = 'Bfrtip',\n    buttons = c('copy', 'csv', 'excel', 'colvis'),\n    scrollX = TRUE,\n    scrollY = \"600px\",\n    scroller = TRUE,\n    pageLength = 20,\n    columnDefs = list(\n      list(className = 'dt-right', targets = 1:5),  # Right-align numeric columns\n      list(className = 'dt-left', targets = c(0, 6))  # Left-align state and comment columns\n    )\n  ),\n  rownames = FALSE,\n  filter = 'top',\n  caption = \"Enhanced Data with Estimated Totals\"\n)\n\n# Create final frozen version (v1.0)\nfrozen_dir_relative <- file.path(\"data\", \"v1.0\")\nfrozen_dir <- here(frozen_dir_relative)\ndir.create(frozen_dir, recursive = TRUE, showWarnings = FALSE)\n\nfrozen_path_relative <- file.path(frozen_dir_relative, \"SDIS_cross_section.csv\")\nfrozen_path <- here(frozen_path_relative)\nwrite_csv(sdis_final, frozen_path)\ncat(paste(\"‚úì Created frozen version 1.0 at:\", frozen_path_relative, \"\\n\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nExported enhanced SDIS dataset to: data/sdis/final/SDIS_cross_section.csv \n\n\nFinal Summary Statistics:\n=================================================\nTotal states in dataset: 50 \nStates with n_total_estimated: 29 \nStates with n_total_reported: 29 \nTotal profiles (estimated): 13,763,794 \n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-c79a40944557be5ca901\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c79a40944557be5ca901\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\",\"ColReorder\",\"Scroller\"],\"caption\":\"<caption>Enhanced Data with Estimated Totals<\\/caption>\",\"data\":[[\"Alabama\",\"Alaska\",\"Arizona\",\"Arkansas\",\"California\",\"Colorado\",\"Connecticut\",\"Delaware\",\"Florida\",\"Georgia\",\"Hawaii\",\"Idaho\",\"Illinois\",\"Indiana\",\"Iowa\",\"Kansas\",\"Kentucky\",\"Louisiana\",\"Maine\",\"Maryland\",\"Massachusetts\",\"Michigan\",\"Minnesota\",\"Mississippi\",\"Missouri\",\"Montana\",\"Nebraska\",\"Nevada\",\"New Hampshire\",\"New Jersey\",\"New Mexico\",\"New York\",\"North Carolina\",\"North Dakota\",\"Ohio\",\"Oklahoma\",\"Oregon\",\"Pennsylvania\",\"Rhode Island\",\"South Carolina\",\"South Dakota\",\"Tennessee\",\"Texas\",\"Utah\",\"Vermont\",\"Virginia\",\"Washington\",\"West Virginia\",\"Wisconsin\",\"Wyoming\"],[\"  360,000\",\"   79,146\",null,\"   12,221\",\"3,365,402\",\"  499,170\",\"  135,006\",null,\"1,799,228\",\"  347,145\",null,\"   39,000\",\"  689,297\",\"  479,000\",null,null,null,\"  699,618\",null,\"  194,803\",null,null,\"  180,000\",\"  118,000\",\"  400,000\",\"   32,284\",null,\"  245,000\",null,\"  346,099\",null,null,\"  380,000\",null,null,null,null,null,\"   27,818\",\"  175,629\",\"   94,000\",\"  518,614\",\"1,342,285\",null,null,\"  523,069\",\"  272,000\",\"   51,349\",\"  358,611\",null],[\"  360,000\",\"   79,146\",null,\"   12,221\",\"3,365,402\",\"  499,170\",\"  135,006\",null,\"1,799,228\",\"  347,145\",null,\"   39,000\",\"  689,297\",\"  479,000\",null,null,null,\"  699,618\",null,\"  194,803\",null,null,\"  180,000\",\"  118,000\",\"  400,000\",\"   32,284\",null,\"  245,000\",null,\"  346,099\",null,null,\"  380,000\",null,null,null,null,null,\"   27,818\",\"  175,629\",\"   94,000\",\"  518,614\",\"1,342,285\",null,null,\"  523,069\",\"  272,000\",\"   51,349\",\"  358,611\",null],[null,\"   26,997\",null,null,null,null,\"  135,006\",null,null,\"  324,864\",null,\"   39,000\",\"  689,297\",\"  310,000\",null,null,null,null,null,\"  142,278\",null,null,\"  180,000\",null,\"  386,000\",\"   32,284\",null,null,null,null,null,null,\"  300,000\",null,null,null,null,null,\"   27,334\",\"  175,629\",null,\"  292,045\",\"1,342,285\",null,null,null,\"  272,000\",\"   47,444\",\"  334,894\",null],[null,\" 52,149\",null,null,null,null,null,\"      0\",null,null,\"      0\",\"      0\",null,\"169,000\",\"      0\",null,\"      0\",null,\"      0\",\"  5,525\",\"      0\",null,null,null,null,\"      0\",\"      0\",null,\"      0\",null,null,\"      0\",\" 50,000\",null,null,null,\"      0\",\"      0\",\"    484\",null,null,\"226,569\",null,null,\"      0\",null,\"      0\",\"      0\",\" 23,717\",\"      0\"],[null,\"  3,866\",null,null,\"167,053\",null,\" 23,200\",null,null,\" 22,281\",null,null,\" 69,927\",\" 23,700\",null,null,null,null,null,null,null,null,null,null,null,\"    878\",null,null,null,null,null,null,null,null,null,null,null,null,\"  1,798\",\" 11,127\",null,null,null,null,null,null,\"  8,800\",\"  3,905\",\" 24,756\",null],[\"Total only reported (no breakdown available)\",\"Used reported total (matches offenders + arrestees)\",\"\",\"Total only reported (no breakdown available)\",\"Total only reported (forensic reported separately)\",\"Total only reported (no breakdown available)\",\"Used reported total (matches offenders only)\",\"\",\"Total only reported (no breakdown available)\",\"Total with discrepancy (calculation unclear)\",\"\",\"Used reported total (matches offenders only)\",\"Used reported total (matches offenders only)\",\"Used reported total (matches offenders + arrestees)\",\"\",\"\",\"\",\"Total only reported (no breakdown available)\",\"\",\"Total with discrepancy (calculation unclear)\",\"\",\"\",\"Used reported total (matches offenders only)\",\"Total only reported (no breakdown available)\",\"Total with discrepancy (calculation unclear)\",\"Used reported total (matches offenders only)\",\"\",\"Total only reported (no breakdown available)\",\"\",\"Total only reported (no breakdown available)\",\"\",\"\",\"Total with discrepancy (calculation unclear)\",\"\",\"\",\"\",\"\",\"\",\"Used reported total (matches offenders + arrestees)\",\"Used reported total (matches offenders only)\",\"Total only reported (no breakdown available)\",\"Used reported total (matches offenders + arrestees)\",\"Used reported total (matches offenders only)\",\"\",\"\",\"Total only reported (no breakdown available)\",\"Used reported total (matches offenders only)\",\"Total with discrepancy (calculation unclear)\",\"Used reported total (matches offenders + arrestees)\",\"\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>state<\\/th>\\n      <th>n_total_estimated<\\/th>\\n      <th>n_total_reported<\\/th>\\n      <th>n_offenders<\\/th>\\n      <th>n_arrestees<\\/th>\\n      <th>n_forensic<\\/th>\\n      <th>n_total_estimated_comment<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"dom\":\"Bfrtip\",\"buttons\":[\"copy\",\"csv\",\"excel\",\"colvis\"],\"scrollX\":true,\"scrollY\":\"600px\",\"scroller\":true,\"pageLength\":20,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"className\":\"dt-left\",\"targets\":[0,6]},{\"name\":\"state\",\"targets\":0},{\"name\":\"n_total_estimated\",\"targets\":1},{\"name\":\"n_total_reported\",\"targets\":2},{\"name\":\"n_offenders\",\"targets\":3},{\"name\":\"n_arrestees\",\"targets\":4},{\"name\":\"n_forensic\",\"targets\":5},{\"name\":\"n_total_estimated_comment\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n‚úì Created frozen version 1.0 at: data/v1.0/SDIS_cross_section.csv \n```\n\n\n:::\n:::\n\n\n# Comparison between NDIS and SDIS datasets\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show NDIS and SDIS comparison code\"}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(scales)\nlibrary(patchwork)\n\n# Read frozen datasets\nndis <- read_csv(here(\"data\", \"v1.0\", \"NDIS_time_series.csv\"))\nsdis <- read_csv(here(\"data\", \"v1.0\", \"SDIS_cross_section.csv\"))\n\n# Check what date column exists in NDIS data\ndate_col <- if(\"year_month\" %in% names(ndis)) {\n  \"year_month\"\n} else if(\"date\" %in% names(ndis)) {\n  \"date\"\n} else if(\"snapshot_date\" %in% names(ndis)) {\n  \"snapshot_date\"\n} else {\n  # If no date column, we can't filter by latest\n  NULL\n}\n\n# Extract latest NDIS data for each jurisdiction\nif (!is.null(date_col)) {\n  ndis_latest <- ndis %>%\n    group_by(jurisdiction) %>%\n    filter(.data[[date_col]] == max(.data[[date_col]])) %>%\n    ungroup() %>%\n    select(jurisdiction, ndis_profiles = total_profiles)\n} else {\n  # If no date column, just take the data as-is (assuming it's already latest)\n  ndis_latest <- ndis %>%\n    select(jurisdiction, ndis_profiles = total_profiles) %>%\n    distinct(jurisdiction, .keep_all = TRUE)\n}\n\n# Prepare SDIS data\nsdis_summary <- sdis %>%\n  mutate(sdis_profiles = if_else(is.na(n_total_reported), n_total_estimated, n_total_reported)) %>%\n  select(jurisdiction = state, sdis_profiles)\n\n# Combine datasets\ncombined <- full_join(ndis_latest, sdis_summary, by = \"jurisdiction\") %>%\n  mutate(\n    ndis_profiles = replace_na(ndis_profiles, 0),\n    sdis_profiles = replace_na(sdis_profiles, NA)\n  )\n\nplot_data <- combined %>%\n  pivot_longer(cols = c(ndis_profiles, sdis_profiles),\n               names_to = \"source\", values_to = \"profiles\") %>%\n  mutate(\n    profiles = replace_na(profiles, 0),\n    source = factor(source, levels = c(\"sdis_profiles\", \"ndis_profiles\"), \n                    labels = c(\"SDIS\", \"NDIS\"))\n  )\n\n# Divide into two groups\nhigh_states <- plot_data %>%\n  group_by(jurisdiction) %>%\n  summarise(total = sum(profiles, na.rm = TRUE)) %>%\n  filter(total > 400000) %>%\n  pull(jurisdiction) %>%\n  sort()\n\nlow_states <- plot_data %>%\n  filter(!jurisdiction %in% high_states) %>%\n  pull(jurisdiction) %>%\n  unique() %>%\n  sort()\n\n# Plot function with publication-quality styling\nplot_profiles <- function(data, states, title) {\n  data <- data %>%\n    mutate(jurisdiction = factor(jurisdiction, levels = rev(states)))\n  \n  ggplot(data %>% filter(jurisdiction %in% states),\n         aes(y = jurisdiction, x = profiles, fill = source)) +\n    geom_col(position = position_dodge(width = 0.7), width = 0.6, \n             color = \"black\", linewidth = 0.3) +\n    scale_fill_manual(\n      values = c(\"NDIS\" = \"#1f77b4\", \"SDIS\" = \"#ff7f0e\"),\n      labels = c(\"NDIS\", \"SDIS\")\n    ) +\n    scale_x_continuous(labels = label_number(scale_cut = cut_short_scale())) +\n    labs(title = title, y = \"Jurisdiction\", x = \"Total Profiles\", fill = \"Source\") +\n    theme_minimal(base_size = 14) +\n    theme(\n      axis.text.y = element_text(size = 12, color = \"black\"),\n      axis.text.x = element_text(size = 12, color = \"black\"),\n      axis.title = element_text(size = 13, face = \"bold\"),\n      plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5),\n      legend.position = \"top\",\n      legend.text = element_text(size = 12),\n      legend.title = element_text(size = 12, face = \"bold\"),\n      panel.grid.major.x = element_line(color = \"gray90\", linewidth = 0.3),\n      panel.grid.minor = element_blank(),\n      panel.grid.major.y = element_blank(),\n      panel.border = element_rect(color = \"black\", fill = NA, linewidth = 0.5),\n      axis.line = element_line(color = \"black\", linewidth = 0.3),\n      axis.ticks = element_line(color = \"black\", linewidth = 0.3),\n      axis.ticks.length = unit(0.15, \"cm\"),\n      plot.background = element_rect(fill = \"white\", color = NA),\n      panel.background = element_rect(fill = \"white\", color = NA)\n    )\n}\n\n# Plot for high profile states (alphabetical order, reversed for y-axis)\np_high <- plot_profiles(plot_data, high_states, \"States with >400k Total Profiles\")\n\n# Plot for low profile states (alphabetical order, reversed for y-axis)\np_low <- plot_profiles(plot_data, low_states, \"States with ‚â§400k Total Profiles\")\n```\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](sdis_summary_files/figure-html/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n",
    "supporting": [
      "sdis_summary_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.34.0/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<script src=\"../site_libs/jszip-1.13.6/jszip.min.js\"></script>\n<link href=\"../site_libs/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.html5.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js\"></script>\n<script src=\"../site_libs/dt-ext-buttons-1.13.6/js/buttons.print.min.js\"></script>\n<link href=\"../site_libs/dt-ext-colreorder-1.13.6/css/colReorder.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-ext-colreorder-1.13.6/js/dataTables.colReorder.min.js\"></script>\n<link href=\"../site_libs/dt-ext-scroller-1.13.6/css/scroller.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-ext-scroller-1.13.6/js/dataTables.scroller.min.js\"></script>\n<link href=\"../site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"../site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.2/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.2/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}